@if (open()) {
  <div class="modal-backdrop" (click)="onBackdropClick()" (keydown)="onKeydown($event)" tabindex="-1">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Accès connexion" (click)="$event.stopPropagation()">
      <header class="modal-header">
        <div>
          <div class="modal-title">{{ title() }}</div>
          <div class="modal-sub">Utilisateur : <span class="strong">{{ userLabel() }}</span></div>
        </div>

        <button type="button" class="icon-btn" (click)="cancel.emit()" [disabled]="saving()" aria-label="Fermer"><i class="bi bi-x-lg"></i> ✕</button>
      </header>

      <section class="modal-body">
        @if (error()) {
          <div class="state error"><strong>Erreur :</strong> {{ error() }}</div>
        }

        <form class="form" [formGroup]="form" (ngSubmit)="submit()">
          <div class="field">
            <label>Mot de passe (min 8, 1 majuscule, 1 minuscule, 1 chiffre)</label>
            <input type="text" formControlName="password" placeholder="Saisir ou générer…" />
            <div class="actions-inline">
              <button type="button" class="btn-outline btn-xs" (click)="generate()" [disabled]="saving()">Générer</button>
              <button type="button" class="btn-outline btn-xs" (click)="copyPassword()" [disabled]="saving()">Copier</button>
            </div>

            @if (form.controls.password.touched && form.controls.password.invalid) {
              <small class="hint error">Mot de passe requis (min 8, 1 majuscule, 1 minuscule, 1 chiffre).</small>
            }
          </div>

          <label class="check">
            <input type="checkbox"
                   [checked]="form.controls.mustChangePassword.value"
                   (change)="onMustChangePasswordChange($event)" />
            <span>Forcer l’utilisateur à changer le mot de passe au 1er login</span>
          </label>

          <footer class="modal-actions">
            <button type="button" class="btn-outline" (click)="cancel.emit()" [disabled]="saving()"><i class="bi bi-x"></i> Annuler</button>
            <button type="submit" class="btn-primary" [disabled]="saving()"><i class="fa-solid fa-check"></i> 
              @if (saving()) { Enregistrement… } @else { Confirmer }
            </button>
          </footer>
        </form>
      </section>
    </div>
  </div>
}

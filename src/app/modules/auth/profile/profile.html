<section class="profile-page">
  <header class="profile-hero">
    <div class="hero-left">
      <div class="avatar">
        @if (photoUrl()) {
          <img [src]="photoUrl()" alt="Photo de profil" />
        } @else {
          <span>{{ initials() }}</span>
        }
      </div>
      <div class="hero-text">
        <span class="hero-label"><span class="material-icons notranslate">person</span>Profil utilisateur</span>
        <h1>{{ displayName() }}</h1>
        <div class="role-pill">{{ roleLabel() }}</div>
        <div class="hero-meta">
          <div class="meta-item">
            <span class="material-icons notranslate">mail</span>
            <span>{{ user()?.email || '—' }}</span>
          </div>
          <div class="meta-item">
            <span class="material-icons notranslate">call</span>
            <span>{{ user()?.phone || '—' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-actions">
      <label class="btn-outline upload-btn">
        <input type="file" accept="image/png,image/jpeg" (change)="onPhotoSelected($event)" [disabled]="uploadLoading()" />
        <i class="bi bi-camera"></i>
        <span>@if (uploadLoading()) { Import... } @else { Changer la photo }</span>
      </label>
      @if (uploadError()) {
        <div class="state error upload-error">{{ uploadError() }}</div>
      }
    </div>
  </header>

  @if (!user()) {
    <div class="state error card">Aucun utilisateur connecté.</div>
  } @else {
    <section class="profile-grid">
      <article class="card">
        <div class="card-title"><span class="material-icons notranslate">badge</span>Informations principales</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">mail</span>Email</span>
            <span class="value">{{ user()?.email || '—' }}</span>
          </div>
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">call</span>Téléphone</span>
            <span class="value">{{ user()?.phone || '—' }}</span>
          </div>
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">shield</span>Rôle</span>
            <span class="value">{{ roleLabel() }}</span>
          </div>
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">warehouse</span>Dépôt</span>
            <span class="value">{{ depotLoading() ? 'Chargement…' : depotName() }}</span>
          </div>
        </div>
      </article>

      <article class="card">
        <div class="card-title"><span class="material-icons notranslate">assignment</span>Affectations</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">directions_car</span>Véhicule assigné</span>
            <span class="value">{{ user()?.assignedVehicle || '—' }}</span>
          </div>
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">verified</span>Statut</span>
            <span class="value">Actif</span>
          </div>
        </div>
        <p class="hint">
          Besoin de modifier tes informations ? Contacte un administrateur.
        </p>
      </article>

      <article class="card">
        <div class="card-title"><span class="material-icons notranslate">lock</span>Accès & permissions</div>
        <div class="access-list">
          @for (item of accessItems(); track item.label) {
            <div class="access-item">
              <span class="material-icons notranslate">{{ item.icon }}</span>
              <div>
                <div class="access-title">{{ item.label }}</div>
                <div class="access-desc">{{ item.desc }}</div>
              </div>
            </div>
          }
          @if (accessItems().length === 0) {
            <div class="access-empty">Aucun accès spécifique.</div>
          }
        </div>
      </article>

      <article class="card">
        <div class="card-title"><span class="material-icons notranslate">support_agent</span>Assistance</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">info</span>Support</span>
            <span class="value">Contacte ton administrateur pour toute mise à jour.</span>
          </div>
          <div class="info-item">
            <span class="label"><span class="material-icons notranslate">shield</span>Sécurité</span>
            <span class="value">Session active sur ce navigateur.</span>
          </div>
        </div>
      </article>
    </section>
  }
</section>

<div class="login-page">
  <div class="login-card">
    <section class="login-brand">
      <div class="brand-mark">FXN</div>
      <h1>Connexion</h1>
      <p>Accédez à votre ERP et pilotez vos opérations en temps réel.</p>
      <ul class="brand-list">
        <li>Stocks et flux centralisés</li>
        <li>Suivi terrain instantané</li>
        <li>Rapports clairs et fiables</li>
      </ul>
    </section>

    <section class="login-form">
      <h2>Accès sécurisé</h2>
      <p class="form-subtitle">Utilisez votre adresse professionnelle pour continuer.</p>

      @if (error()){
        <div class="error">{{ error() }}</div>
      }
      @if (success()){
        <div class="success">{{ success() }}</div>
      }

      @if (step() === 'login') {
        <form [formGroup]="form" (ngSubmit)="submit()">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input id="login-email" formControlName="email" type="email" autocomplete="email" placeholder="admin@fxn.local" />
          </div>

          <div class="form-group">
            <label for="login-password">Mot de passe</label>
            <input
              id="login-password"
              formControlName="password"
              type="password"
              autocomplete="current-password"
              placeholder="Entrez votre mot de passe"
            />
          </div>

          <div class="form-group">
            <label for="login-mfa">Code MFA</label>
            <input id="login-mfa" formControlName="mfaCode" type="text" autocomplete="one-time-code" placeholder="123456" />
            @if (mfaRequired()) {
              <div class="hint">Un code a été envoyé par email.</div>
            }
          </div>

          <div class="remember-device">
            <label>
              <input type="checkbox" formControlName="rememberDevice" />
              <span>Se souvenir de cet appareil (30 jours)</span>
            </label>
          </div>

          <button type="submit" [disabled]="loading()">
            @if (loading()){
              <span>Connexion...</span>
            }@else{
              <span>Se connecter</span>
            }
          </button>
        </form>
      }

      @if (step() === 'password') {
        <form [formGroup]="passwordForm" (ngSubmit)="submitPasswordChange()">
          <div class="form-group">
            <label for="new-password">Nouveau mot de passe</label>
            <input id="new-password" formControlName="newPassword" type="password" autocomplete="new-password" placeholder="Min 8, 1 majuscule, 1 chiffre" />
          </div>

          <div class="form-group">
            <label for="confirm-password">Confirmer le mot de passe</label>
            <input id="confirm-password" formControlName="confirmPassword" type="password" autocomplete="new-password" placeholder="Confirmez le mot de passe" />
          </div>

          <div class="form-group">
            <label for="mfa-reset">Code MFA (si activé)</label>
            <input id="mfa-reset" formControlName="mfaCode" type="text" autocomplete="one-time-code" placeholder="123456" />
          </div>

          <button type="submit" [disabled]="loading()">
            @if (loading()){
              <span>Mise à jour...</span>
            }@else{
              <span>Mettre à jour</span>
            }
          </button>

          <button class="btn-link" type="button" (click)="backToLogin()">Revenir</button>
        </form>
      }
    </section>
  </div>
</div>

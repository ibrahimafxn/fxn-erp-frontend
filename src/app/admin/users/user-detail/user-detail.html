<section class="user-detail">

  <header class="page-header">
    <div>
      <h1>Détails utilisateur</h1>
      <p class="subtitle">Fiche complète d’un employé</p>
    </div>

    <div class="header-actions">
      <button class="btn-outline" type="button" (click)="back()"><i class="bi bi-arrow-left"></i> Retour</button>
    </div>
  </header>

  @if (loading()) {
    <div class="state loading">Chargement…</div>
  } @else if (error()) {
    <div class="state error">
      Une erreur est survenue :
      <code>{{ error() }}</code>
    </div>
  } @else if (user(); as u) {

    <article class="user-card">

      <div class="identity">
        <div class="avatar">
          @if (avatarSrc(u); as avatar) {
            <img [src]="avatar" alt="Photo de profil" />
          } @else {
            <span>{{ (u.firstName || '—').charAt(0) }}{{ (u.lastName || '—').charAt(0) }}</span>
          }
        </div>

        <div class="identity-text">
          <h2>{{ userName(u) }}</h2>
          <span class="role-badge role-{{ (u.role || '').toLowerCase() }}">
            {{ u.role || '—' }}
          </span>
        </div>
      </div>

      <div class="info-grid">
        <div class="info-item">
          <label>Email</label>
          <span>{{ u.email || '—' }}</span>
        </div>

        <div class="info-item">
          <label>Téléphone</label>
          <span>{{ u.phone || '—' }}</span>
        </div>

        <div class="info-item">
          <label>Dépôt</label>
          <span>{{ depotText() }}</span>
        </div>

        <div class="info-item">
          <label>Véhicule</label>
          <span>{{ vehicleText() }}</span>
        </div>

        <div class="info-item">
          <label>Username</label>
          <span>{{ usernameText() }}</span>
        </div>

        <div class="info-item">
          <label>Créé le</label>
          <span>{{ createdAtText() }}</span>
        </div>

        <div class="info-item">
          <label>Mis à jour</label>
          <span>{{ updatedAtText() }}</span>
        </div>
      </div>

      <footer class="card-actions">
        <button class="btn-outline edit" type="button" (click)="edit(u)"><i class="bi bi-pencil"></i> Modifier</button>

        <button class="btn-outline delete" type="button" [disabled]="deleting()" (click)="delete(u)"><i class="fa-solid fa-trash"></i> 
          @if (deleting()) { Suppression… } @else { Supprimer }
        </button>
      </footer>
    </article>

  } @else {
    <div class="state empty">Utilisateur introuvable.</div>
  }

  <!-- ✅ Modal suppression -->
  <app-confirm-delete-modal
    [open]="deleteModalOpen()"
    entityLabel="l’utilisateur"
    [entityName]="pendingDeleteName()"
    [entityId]="pendingDeleteId()"
    [confirming]="deleting()"
    dangerHint="Cette action est irréversible."
    (cancel)="closeDeleteModal()"
    (confirm)="confirmDelete()"
  />
</section>
